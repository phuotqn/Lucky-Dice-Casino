<!DOCTYPE html>
<html>

<head>
    <title>Lucky Dice Casino</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- class CSS để dùng trong bài -->
    <style>
        .picture-cover {
            background-image: url("LuckyDiceImages/cover.jpg");
            min-height: 100px;
            margin: 5px;
        }
    </style>
</head>

<body>
    <div class="container-fluid  picture-cover">

    </div>
    <div class="container ">
        <div class="row ">
            <div class="col-5 bg-white  ">
                <div class="row  form-group">
                    <div class="col-12">
                        <!-- Tại dòng 2.1.1.1 thêm một div column rộng 12 đơn vị -->
                        <h4>Nhập thông tin của bạn</h4>
                    </div>
                </div>
                <div class="row   form-group">
                    <!-- tại mỗi dòng 2.1.1.2 thêm 2 div column có chiều rộng lần lượt là 4, 8 đơn vị -->
                    <div class="col-4  ">
                        <!-- chiều rộng 4 đơn vị (col-4) -->
                        <label>Username</label>
                    </div>
                    <div class="col-8  ">
                        <!-- chiều rộng 8 đơn vị (col-8) -->
                        <input id="inp-user-name" class="form-control" type="text">
                    </div>
                </div>
                <div class="row   form-group">
                    <!-- tại mỗi dòng 2.1.1.3 thêm 2 div column có chiều rộng lần lượt là 4, 8 đơn vị -->
                    <div class="col-4  ">
                        <!-- chiều rộng 4 đơn vị (col-4) -->
                        <label>Firstname</label>
                    </div>
                    <div class="col-8  ">
                        <!-- chiều rộng 8 đơn vị (col-8) -->
                        <input id="inp-first-name" class="form-control" type="text">
                    </div>
                </div>
                <div class="row   form-group">
                    <!-- tại mỗi dòng 2.1.1.4 thêm 2 div column có chiều rộng lần lượt là 4, 8 đơn vị -->
                    <div class="col-4  ">
                        <!-- chiều rộng 4 đơn vị (col-4) -->
                        <label>Lastname</label>
                    </div>
                    <div class="col-8  ">
                        <!-- chiều rộng 8 đơn vị (col-8) -->
                        <input id="inp-last-name" class="form-control" type="text">
                    </div>
                </div>
            </div>
            <div class="col-4  text-center">
                <!-- Tại cột 2.1.2 tạo 3 div class row, cột 2.1.2 có thuộc tính căn giữa -->
                <div class="row form-group">
                    <div class="col-12   ">
                        <!-- trong mỗi row chứa 1 cột rộng 12 đơn vị -->
                        <input id="btn-dice" class="btn btn-success button-width w-75" value="Ném" type="button">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-12   ">
                        <!-- trong mỗi row chứa 1 cột rộng 12 đơn vị-->
                        <img id="img-dice" class="img-thumbnail" src="LuckyDiceImages/dice.png">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-12   ">
                        <!-- trong mỗi row chứa 1 cột rộng 12 đơn vị -->
                        <p id="p-notification-dice">Chúc mừng</p>
                    </div>
                </div>
            </div>
            <div class="col-3  text-center">
                <!-- Tại cột 2.1.3 tạo 2 div class row, cột 2.1.3 có thuộc tính căn giữa -->
                <div class="row form-group">
                    <div class="col-12   ">
                        <!-- trong mỗi row chứa 1 cột rộng 12 đơn vị -->
                        <p>Voucher</p>
                        <p id="p-voucher-id">No ID</p>
                        <p id="p-voucher-percent">0%</p>
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-12   ">
                        <!-- trong mỗi row chứa 1 cột rộng 12 đơn vị-->
                        <img id="img-present" class="img-thumbnail" src="LuckyDiceImages/motobike.jpg">
                    </div>
                </div>
            </div>
        </div>
        <div class="row  text-center form-group">
            <!-- Tại row 2.2 thêm một div column rộng 12 đơn vị  -->
            <div class="col-12">
                <button id="btn-dice-history" class="btn btn-info button-width w-25">Dice History</button>
                <button id="btn-voucher-history" class="btn btn-success button-width w-25">Voucher History</button>
                <button id="btn-present-history" class="btn btn-success button-width w-25">Present History</button>
            </div>
        </div>
        <div class="row ">
            <!-- Tại row 2.3 thêm một div column rộng 12 đơn vị  -->
            <div class="col-12">
                <table id="history-placeholder-table" class="table table-striped table-hover ">
                    <tr>
                        <th>Lượt</th>
                        <th>Dice</th>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>2</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>4</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>4</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
<script>
    "use strict!"
    //** Global variebles - Vùng khai báo biến toàn cục
    const gREQUEST_READY_STATUS_FINISH_AND_OK = 4;
    const gREQUEST_STATUS_OK = 200;
    const vBASE_URL = "http://42.115.221.44:8080/devcamp-lucky-dice/";
    const vUTF8_TEXT_APPLICATION_HEADER = "application/json;charset=UTF-8";
    const gCOL_TURN = 0;
    const gCOL_DICES = 1;
    const gEND_OF_ROW_COL = -1;
    "use strict";
    /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
    var vUserObj = {
        usename: "",
        firstname: "",
        lastname: ""
    };
    /*** REGION 2 - Vùng gán / thực thi sự kiện cho các elements */
    $(document).ready(function () {
        $("#btn-dice").on("click", onBtnDiceClick);
    })

    /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
    // Hàm xử lý sự kiện nút ném
    function onBtnDiceClick() {
        //Bước 1: Thu thập dữ liệu
        getUserData(vUserObj);
        //Bước 2: Kiểm tra dữ liệu
        var vIsCheck = validateData(vUserObj);
        if (vIsCheck) {
            var vXmlHttpDice = new XMLHttpRequest();
            callApiSeverDice(vXmlHttpDice, vUserObj);
            vXmlHttpDice.onreadystatechange = function () {
                if (this.readyState == gREQUEST_READY_STATUS_FINISH_AND_OK && this.status == gREQUEST_STATUS_OK) {
                    proccessResponse(vXmlHttpDice);
                }
            }
        }
        //Bước 3: gọi API sever
    }
/*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
    function getUserData(paramUser) {
        var vInputFirstName = $("#inp-first-name");
        var vInputLastName = $("#inp-last-name");
        var vInputUserName = $("#inp-user-name");

        paramUser.username = vInputUserName.val().trim();
        paramUser.firstname = vInputFirstName.val().trim();
        paramUser.lastname = vInputLastName.val().trim();
    }
    function  validateData(paramUser) {
        if (paramUser.username === "") {
            alert("Bạn cần nhập thông tin vào")
            return false;
        }
        if (paramUser.firstname === "") {
            alert("Bạn chưa nhập họ vào!")
            return false;
        }
        if (paramUser.lastname === "") {
            alert("Bạn chưa nhập tên vào!")
            return false;
        }
        return true;
    }
    // Hàm gọi api
    function callApiSeverDice(paramXmlHttp, paramUserData) {
        paramXmlHttp.open("POST", vBASE_URL + "/dice", true);
        paramXmlHttp.setRequestHeader("Content-Type", vUTF8_TEXT_APPLICATION_HEADER);
        paramXmlHttp.send(JSON.stringify(paramUserData));
    }
    // Hàm xử lý response text
    function proccessResponse(paramXmlHttp) {
        console.log(paramXmlHttp.responseText);
        var vResponseInObject = JSON.parse(paramXmlHttp.responseText);
        console.log(vResponseInObject);
         // get result dice
         var vDiceReady = vResponseInObject.dice;
        console.log("Mặt xúc xắc là: " + vDiceReady);
        //Gọi hàm để hiển thị hình ảnh dice
        changeDice(vDiceReady);
        //Gọi hàm để hiển thị lời nhắn
        changeNotifications(vDiceReady);
        changeVoucherId(vResponseInObject); //Hiện mã giảm giá
        changeGift(vResponseInObject); // Hiện phần thưởng
    }
    function changeDice(paramDice) {
        "use strict"
        var vImgDice = $("#img-dice");
        switch (paramDice) {
            case 1:
                vImgDice.attr("src","LuckyDiceImages/1.png");
                break;
            case 2:
                vImgDice.attr("src","LuckyDiceImages/2.png");
                break;
            case 3:
                vImgDice.attr("src","LuckyDiceImages/3.png");
                break;
            case 4:
                vImgDice.attr("src","LuckyDiceImages/4.png");
                break;
            case 5:
                vImgDice.attr("src","LuckyDiceImages/5.png");
                break;
            default:
                vImgDice.attr("src","LuckyDiceImages/6.png");
        }
    }
    function changeNotifications(paramDice) {
        var vNotifcation = $("#p-notification-dice");
        if (paramDice < 4) {
            vNotifcation.html("Chúc bạn may mắn lần sau !!!");
        }
        else {
            vNotifcation.html("Chúc mừng mời bạn chơi tiếp lần nữa !!!");
        }
    }
    function changeVoucherId(paramVoucherResponse) {
        var vPVoucherId = $("#p-voucher-id");
        var vPVoucherPercent = $("#p-voucher-percent");

        if (paramVoucherResponse != null) {
            vPVoucherId.html(paramVoucherResponse.voucher.maVoucher);
            vPVoucherPercent.html(paramVoucherResponse.voucher.phanTramGiamGia + "%");
        }
        else if(paramVoucherResponse = null) {
            vPVoucherId.html() = "";
            vPVoucherPercent.html() = "";
        }
    }
    function changeGift(paramResponsePrize) {
        var vImgPresent = $("#img-present");
        var vTenPhanThuong = paramResponsePrize.prize;
        switch (vTenPhanThuong) {
            case "Mũ":
                vImgPresent.attr("src","LuckyDiceImages/hat.jpg");
                break;
            case "Áo":
                vImgPresent.attr("src","LuckyDiceImages/t-shirt.jpg");
                break;
            case "Xe máy":
                vImgPresent.attr("src","LuckyDiceImages/xe-may.jpg");
                break;
            case "Ô tô":
                vImgPresent.attr("src","LuckyDiceImages/car.jpg");
                break;
            default:
                vImgPresent.attr("src","LuckyDiceImages/no-present.jpg");
        }
    }

</script>

</html>